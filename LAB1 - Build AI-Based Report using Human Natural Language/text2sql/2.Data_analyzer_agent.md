# 🤖Membuat AI Agent dengan **watsonx.ai**

Pada lab ini, kita akan membuat **Data Analyzer** dengan memanfaatkan *watsonx.AI Agent Lab*. Agent ini akan menganalisis data Customer yang mengakses BTS.

> **Catatan** File‐file yang diperlukan dapat diunduh dari folder “📂 Assets”.

<i>Persyaratan sebelum menjalankan lab</i>

1. Download file yang ada pada ![link](https://github.com/Client-Engineering-Indonesia/Incubation-Agentic-AI-2025-batch-4-29Oct/blob/main/LAB1%20-%20Build%20AI-Based%20Report%20using%20Human%20Natural%20Language/text2sql/Assets/data_api_ws.csv) ini

2. Masuk ke halaman project

<img width="1920" height="200" alt="image" src="https://github.com/user-attachments/assets/2db74615-a4df-4bb9-850c-7b5e05835dc4" />

3. klik tombol Import

<img width="1747" height="892" alt="image" src="https://github.com/user-attachments/assets/1231a3a2-a9bc-418f-b8b2-33d68b9f04b5" />

4. Pilih Data Asset -> klik tombol Browse -> pilih file yang sudah di download pada step 1 -> klik Done

<img width="1841" height="912" alt="image" src="https://github.com/user-attachments/assets/aa73ac7a-3c39-496f-b2ff-d8fd619fefba" />

5. Lanjutkan dengan mendownload ![notebook](https://github.com/Client-Engineering-Indonesia/Incubation-Agentic-AI-2025-batch-4-29Oct/blob/main/LAB1%20-%20Build%20AI-Based%20Report%20using%20Human%20Natural%20Language/text2sql/Assets/Query%20to%20Dataframe%20Tool%20-%20Template.ipynb) ini

6. Kembali ke tab Asset dalam project Anda -> klik New Asset -> ketik "Jupyter" di field pencairan -> klik "Work with data and models in Python or R notebook"

<img width="1784" height="897" alt="image" src="https://github.com/user-attachments/assets/ba5d279e-fbaf-42cb-ac35-a7b769d28c69" />

7. Di sisi kiri, pilih Local file -> pilih notebook yang sudah Anda download pada step 5 -> klik Create

<img width="1812" height="881" alt="image" src="https://github.com/user-attachments/assets/d7c154f8-b8da-4555-ac55-977747d70bd1" />

8. Tunggu sampai notebook termuat sepenuhnya lalu arahkan cursor ke cell 1

<img width="1860" height="113" alt="image" src="https://github.com/user-attachments/assets/c59ce1a1-f9dc-458c-8f58-488a0f8bad97" />

9. Klik Code Snippet icon -> klik Read Data -> klik tombol Select data from project -> pilih Data Asset -> pilih data_api_ws.csv -> klik tombol Select

<img width="1913" height="549" alt="image" src="https://github.com/user-attachments/assets/7acdd67b-91bc-43fc-87db-b9eab08a8fcf" />

10. Klik tombol Insert to code cell dan pastikan bahwa anda dapat melihat sample data yang sudah Anda upload

<img width="1866" height="992" alt="image" src="https://github.com/user-attachments/assets/9a305e8e-28a5-4c02-bc55-2c55cc2c2b34" />

11. Lanjut ke cell berikutnya dan isi credentials yang tersedia dengan nilai yang ada pada cell sebelumnya

<img width="493" height="82" alt="image" src="https://github.com/user-attachments/assets/ca3ba0e5-2fcd-4e87-aa38-423d336136b5" />

12. Jalankan semua cell sampai Anda mendapatkan tampilan seperti di bawah ini

<img width="832" height="754" alt="image" src="https://github.com/user-attachments/assets/dd927b48-79e9-48ae-b253-717f46de3784" />

---

# 🧭Tahapan Pembuatan Agent

## Step 1 — Membuat *Project*

1. Scroll kebawah lalu buat Project baru di **Watsonx.AI** dengan menekan tombol "+".

![5.Create new Project for agent](https://github.com/Client-Engineering-Indonesia/workshop-telco-tower-ai/blob/main/Lab2-AgenticAI%20in%20watsonxAI/Assets/5.Create%20new%20Project%20for%20agent.png)

2. Menamai dan membuat project baru.

![Create a  Project](https://github.com/user-attachments/assets/1282049d-f55e-47f6-9ff9-e176dd3e4af8)

---

## 🔗 Step 2 — Mengasosiasikan watsonx.ai Runtime

1. Buka Halaman Project dan tekan **Manage**

![6.Press Manage](https://github.com/Client-Engineering-Indonesia/workshop-telco-tower-ai/blob/main/Lab2-AgenticAI%20in%20watsonxAI/Assets/6.Press%20Manage.png)

2. Buka **Services & Integrations → Associate Service**.

![7.Press Service Integration](https://github.com/Client-Engineering-Indonesia/workshop-telco-tower-ai/blob/main/Lab2-AgenticAI%20in%20watsonxAI/Assets/7.Press%20Service%20Integration.png)

3. Pilih **watsonx.ai** lalu kaitkan dengan project.

![9.Instance to associate](https://github.com/user-attachments/assets/3e22c81c-288c-445c-a5c8-6cffb5976012)

---

### 🗂️ Step 3 — Menambahkan *Asset* Baru
1. Masuk ke tab **Assets** dan klik **New Asset**.

![10.Make a New Asset](https://github.com/Client-Engineering-Indonesia/workshop-telco-tower-ai/blob/main/Lab2-AgenticAI%20in%20watsonxAI/Assets/10.Make%20a%20new%20Assets.png)

---

### 🧠 Step 4 — Buat AI Agent
- Klik **New Asset** di sisi kiri dan pilih **Build an AI Agent to Automate Tasks**.

![Build AI Agent](https://github.com/user-attachments/assets/c6dde849-5455-45a8-a82d-9cd11b135933)

## 📝 Step 5 - Instruksi ke agent

1. Click Set up lalu masukan namai agent anda sebagai "API Expert_your initials".

2. masukkan kalimat dibawah untuk deskripsi Agent.

```text
You are expert to query from DB2 database by converting the input by the user into SQL code for DB2 
```

- Masukkan juga **Agent instructions** yang telah tertulis dibawah.

```text

To complete your task, follow the instructions as below:
1. Convert user natural language into SQL statement. Please refer to table_schema as below:

Table name: 'data_api_ws'
Table desciption: A table to store API payload status per request id
Columns:
- `request id`: Unique identifier to represent a request
- `api code`: API code that is being called
- `time of call`: starting time of API being called
- `api call duration`: duration from API being called until finished in second
- `status`: status of API call
Data Sample:
[{'request id': '024aae60-1a81-3f37-bbe6-3f832c919706',
  'api code': 'A1',
  'time of call': '01-02-2025 00:00:00',
  'api call duration': 7.010387097,
  'status': 'success'},
 {'request id': '028d67dd-c6d0-329f-a20e-78db9eab7a55',
  'api code': 'A3',
  'time of call': '01-02-2025 00:17:00',
  'api call duration': 51.41939252,
  'status': 'success'},
 {'request id': '02d12bf9-5fe2-3d0c-b233-30e02224b686',
  'api code': 'A3',
  'time of call': '01-02-2025 00:19:09',
  'api call duration': 25.860775,
  'status': 'success'},
 {'request id': '0b3aee1e-dc3b-3728-bc55-f57a23446b3d',
  'api code': 'A8',
  'time of call': '01-02-2025 00:37:04',
  'api call duration': 0.205909091,
  'status': 'success'},
 {'request id': '0dbfffb4-3ed4-3cb2-904d-c348501a996e',
  'api code': 'A8',
  'time of call': '01-02-2025 00:47:07',
  'api call duration': 0.122125,
  'status': 'failed'}]

2. Call a tool named 'Query to Dataframe' by using input as SQL statement created from step 1.
3. Display raw result of step 2

```

3. Kemudian, apabila ada instruction yang lebih spesifik bisa ditambahkan juga ke dalam **Common instructions** dalam pilihan **Advance Configuration** pada pojok kanan atas.

```text
# Notes

- Use markdown syntax for formatting code snippets, links, JSON, tables, images, files.
- Any HTML tags must be wrapped in block quotes, for example ```<html>```.
- When returning code blocks, specify language.
- Sometimes, things don't go as planned. Tools may not provide useful information on the first few tries. You should always try a few different approaches before declaring the problem unsolvable.
- When the tool doesn't give you what you were asking for, you must either use another tool or a different tool input.
- When using search engines, you try different formulations of the query, possibly even in a different language.
- You cannot do complex calculations, computations, or data manipulations without using tools.
- If you need to call a tool to compute something, always call it instead of saying you will call it.


Here is how to complete your task:

1. Whenever you get the question please directly pass it to the DB2_tools. Do not interpret the question without passing it to the DB2_tools first.

```

![Agent Instruction](https://github.com/user-attachments/assets/062cc7ad-4510-4c08-91cc-9f2b0a94d64d)




## 🖥️ Step 6 — Membuat deployment space untuk mengeksekusi python function

Sebelum menjalankan pyhton pada environment yang ada kita harus me-Deploy Python Engine.

1.  Click Deploy Python Engine.

![22. Deploy Python Engine](https://github.com/Client-Engineering-Indonesia/Incubation-Agentic-AI-2025-batch-3/blob/main/Lab%201%3A%20Build%20AI-agent%20that%20transforms%20natural%20language%20into%20flawless%20SQL%20queries/Assets/22.%20Deploy%20python%20Engine.png)

2. Click "Create" dan follow ke page berikutnya .

3. Click "Create a key" dan kembali ke halaman awal.

![23. Create Key python](https://github.com/Client-Engineering-Indonesia/Incubation-Agentic-AI-2025-batch-3/blob/main/Lab%201%3A%20Build%20AI-agent%20that%20transforms%20natural%20language%20into%20flawless%20SQL%20queries/Assets/23.create%20key%20python.png)

4. Click "Reload".

5. Buat deployment space.

![24. Create deployment space](https://github.com/Client-Engineering-Indonesia/Incubation-Agentic-AI-2025-batch-3/blob/main/Lab%201%3A%20Build%20AI-agent%20that%20transforms%20natural%20language%20into%20flawless%20SQL%20queries/Assets/24.%20create%20deployment%20space.png)

6. Isi nama untuk deployment space dan create.

- Notes : Pastikan mengaktifasi watsonx.AI Runtime pada step ini



## 🧰 Step 7 — Tambahkan tool untuk memanggil data dengan input SQL statement

Di dalam Agent lab watsonx.ai, kita dapat menambahkan tools yang sudah tersedia atau bisa mengkostumisasi tools. Tools ini dapat merubah bahasa manusia sehari hari menjadi SQL Code yang nantinya menjadi jembatan user untuk beriteraksi dengan database sebgai berikut:

## Tools di **Create custom tool**
* Scrool kebawah lalu click tombol dengan nama **"Create custom tool"**
![Add Tool](https://github.com/user-attachments/assets/74596736-0460-45b7-a394-f7323859826c)

### 1. Tool **db2tool**

- Notes: parameter dibawah dapat langsung di _copy_ dan _paste_ pada tempat seperti gambar diatas.

#### Name: ```Query to Dataframe```
     
#### Tool description:

    
    Use this tool to retrieve data from dataframe
    
    
#### Input JSON Schema

```json
{
 "sql_query": {
  "title": "SQL Query",
  "description": "SQL Statement that will be used as input to retrieve data from dataframe",
  "type": "string"
 }
}
```
    
#### Python code:
    
```python
def query_api_data(sql_query):
    import sqlite3
    import pandas as pd

    import os, types
    import pandas as pd
    from botocore.client import Config
    import ibm_boto3
    
    def __iter__(self): return 0
    
    # @hidden_cell
    # The following code accesses a file in your IBM Cloud Object Storage. It includes your credentials.
    # You might want to remove those credentials before you share the notebook.
    
    cos_client = ibm_boto3.client(service_name='s3',
        ibm_api_key_id=ibm_api_key_id,
        ibm_auth_endpoint="https://iam.cloud.ibm.com/identity/token",
        config=Config(signature_version='oauth'),
        endpoint_url=endpoint_url)
    
    bucket = bucket_name
    object_key = 'data_api_ws.csv'
    
    body = cos_client.get_object(Bucket=bucket,Key=object_key)['Body']
    # add missing __iter__ method, so pandas accepts body as file-like object
    if not hasattr(body, "__iter__"): body.__iter__ = types.MethodType( __iter__, body )
    
    df_1 = pd.read_csv(body, sep=';')
    
    # Create in-memory SQLite database
    conn = sqlite3.connect(':memory:')
    
    # Write DataFrame to SQL table
    df_1.to_sql('data_api_ws', conn, index=False, if_exists='replace')
    
    # Query it
    result = pd.read_sql_query(sql_query, conn)
    
    conn.close()

    return result.to_dict(orient='records')
```



### Notes: 
* Anda harus membuat secret melalui tab Configure.

<img width="1779" height="900" alt="image" src="https://github.com/user-attachments/assets/1750bf63-ffff-4c5e-9717-efb349f78762" />

* Sesuaikan nilainya dengan yang Anda dapatkan pada bagian <b>Persyaratan</b>

<img width="924" height="508" alt="image" src="https://github.com/user-attachments/assets/53e09beb-cb85-441a-9a21-6a0aca637d9f" />

* Setelah selesai Anda dapat mengklik tombol Save

## 🧪 Step 8 — Test Agent
Coba pertanyaan berikut:
### **Natural Langguage to SQL (Data Analyzer) Agent**

- how many requests have been performed ?
- show 5 API code that is mostly called

## 👀Step 11 — Lihat Respon Agent

<img width="873" height="705" alt="image" src="https://github.com/user-attachments/assets/cdb0a6ad-6324-42d5-bb76-3dfd22ee10f4" />


## 💾 Step 12 — Simpan Agent

![Save Agent](https://github.com/user-attachments/assets/3c0363a7-cfdf-481a-b365-9ccc0fb1686e)

## 📤 Step 13 — Deploy Agent
- Deploy agent agar dapat digunakan nantinya dalam bentuk API


![Export Agent](https://github.com/user-attachments/assets/3b1d61d0-7285-4621-88cf-8144cee6f598)
![Export Agent](https://github.com/user-attachments/assets/9f92307a-8808-449d-8bcd-3fe73d43258e)

